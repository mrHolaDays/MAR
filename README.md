# MAR Database Manager

Приложение для работы с базами данных в формате MAR. Проект включает графический интерфейс, консольное приложение, серверную реализацию и библиотеку для работы с базами данных.

## Возможности

- Создание и управление базами данных в формате MAR
- Работа с таблицами и записями через графический интерфейс
- Консольное управление базой данных
- Клиент-серверная архитектура с кэшированием и синхронизацией
- Поддержка множества типов данных Python
- Многоязычный интерфейс (русский/английский)
- Темная и светлая темы оформления

## Установка и запуск

### Требования

- Python 3.7+
- Зависимости: `PyQt5`, `colorama`, `pyfiglet`, `simple-term-menu`

Установите зависимости:

```bash
pip install PyQt5 colorama pyfiglet simple-term-menu
```

### Графическое приложение

```bash
python app.py
```

### Консольное приложение

```bash
python app_console.py
```

### Сервер базы данных

```bash
python mardb_server.py [--host localhost] [--port 9999] [--log-level INFO]
```

## Использование графического приложения

1. **Создание базы данных**: File → New Database
2. **Открытие базы**: File → Open Database
3. **Создание таблицы**: Выберите базу → нажмите "Create Table"
4. **Добавление записей**: Перейдите на вкладку "Add Record"
5. **Поиск записей**: Используйте вкладку "Search"
6. **Просмотр записей**: Вкладка "Browse"

### Особенности интерфейса

- Поддержка тем (Settings → Theme)
- Смена языка (Settings → Language)
- Инструкция по использованию (Help → Instructions)

## Использование консольного приложения

Консольное приложение предоставляет текстовый интерфейс для управления базами данных:

```bash
# Главное меню
1. Create Database
2. Open Database
3. Close Database
4. Create Table
5. Add Record
6. Search Record
7. View Records
8. Defragment Database
9. Settings
10. Instructions
11. Exit
```

### Настройки консольного приложения

- Смена языка через меню Settings
- Автоматическое сохранение настроек в `console_settings.json`

## Работа с сервером

### Запуск сервера

```bash
python mardb_server.py --host localhost --port 9999 --log-level INFO
```

### Режимы загрузки данных

- `full` - полная загрузка всех данных в память
- `part` - частичная загрузка на основе .marl файла
- `fast` - загрузка данных по требованию

### Клиентское подключение

```python
from mardb import init_db

# Локальный режим
db = init_db('local')
# Серверный режим
db = init_db('server', 'localhost', 9999)
```

## Использование библиотеки mardb

### Базовые операции

```python
from mardb import init_db

# Инициализация
db = init_db('local')  # или 'server'

# Создание базы данных
db.create_database('test.marm')

# Создание таблицы
db.create_table('test.marm', 'users', ['id', 'name', 'age'])

# Добавление записи
db.insert_into_table('test.marm', 'users', [1, 2, 3], 'John Doe')

# Поиск записи
result = db.find_in_table('test.marm', 'users', [1, 2, 3])

# Выборка всех записей
records = db.select_from_table('test.marm', 'users')

# Дефрагментация
db.defragment_database('test.marm')
```

## Структура и синтаксис базы данных

### Формат файла базы данных (.marm)

1. **Заголовок**:
   - Версия базы данных (3 байта)
   - Разделитель (0xF8)
   - Путь к директории данных
   - Разделитель (0xFA)
   - Резервное пространство (24 байта)
   - Разделитель (0xFA)
   - Количество таблиц (2 байта)

2. **Информация о таблицах**:
   - ID таблицы (2 байта)
   - Имя таблицы (строка)
   - Разделитель (0xFA)
   - Количество колонок (2 байта)
   - Для каждой колонки:
     - ID колонки (2 байта)
     - Имя колонки (строка)
     - Разделитель (0xFA)

### Формат файлов данных (.marc)

1. **Заголовок**:
   - ID таблицы (2 байта)
   - Количество координат (2 байта)
   - Максимальное количество записей (2 байта)
   - Текущее количество записей (2 байта)

2. **Метаданные записей**:
   - Для каждой записи:
     - Значения координат (по 2 байта на каждую)
     - Позиция данных в файле (5 байт)
     - Длина данных (3 байта)

3. **Данные**:
   - Сериализованные данные записей

### Сериализация данных

Библиотека поддерживает сериализацию множества типов данных Python:

- Базовые типы: str, int, float, bool, None
- Коллекции: list, tuple, set, dict, deque
- Специальные типы: datetime, UUID, Decimal, Path
- И многие другие

## Файловая структура проекта

```
MAR-Database-Manager/
│
├── app.py              # Графическое приложение
├── app_console.py      # Консольное приложение
├── mardb.py           # Основная библиотека
├── mardb_server.py    # Сервер базы данных
├── config.py          # Конфигурационные константы
├── database.py        # Функции работы с БД
├── file_operations.py # Операции с файлами
├── serialization.py   # Сериализация данных
│
├── cases/             # Директория для файлов данных
├── config/            # Директория для конфигураций таблиц
│
├── MAR.info           # Файл с инструкциями
└── console_settings.json # Настройки консольного приложения
```

## Принципы работы

1. **Координатная адресация**: Каждая запись идентифицируется набором координат
2. **Фрагментация данных**: Данные хранятся в нескольких файлах для оптимизации
3. **Кэширование**: Серверная версия использует интеллектуальное кэширование
4. **Синхронизация**: Автоматическая синхронизация изменений с диском
